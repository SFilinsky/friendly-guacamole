-- DONE --
- Add extender to bind state reactively.  

- Add TransformNodes for entity.  

- Make state separate for extender instances.  

- Make accessor fields optional.  

- Remove entity setters and trackers (Accessors contain state in their scope)  

- Implement entity method to dynamically apply extenders.  

- Contain extender state inside extender

- Сосредоточить состояние экстендеров в одном месте  
Состояние должно храниться в EntityExtenderInstance в поле state  
Config значения переносятся в state.config
Состояние можно получить через метод getState(), config автоматически подставляется из экстендера
Состояние можно обновить с помощью метода updateState(update: Partial<StateType>)

- Экстендеры должны сообщать о своем обновлении чтобы легко синхронизировать данные по сети

- Система сцен может создавать новые сцены и присваивать им идентификатор.
У сцены есть имя которое можно использовать для её идентификации

-- IDEAS --

- Пользователь может переключать несколько сцен в рантайме
  Системы загружаются до сцен
  Каждая сцена независимо работает с ресурсами и имеет свой UI слой
  Системы работают с определенной сценой, но могут параллельно обрабатывать несколько
  Системы в рамках сцены? Системы абстрагированно от сцен?
  Сущности привязываются к сцене?
  Хуки для отслеживания переключения сцен, их очистки и тд
  Любой экстендер может уничтожить сущность создав событие EntityDestroy?

- Babylon сцена нужна только если используется графика, физика, пространственный звук и т.п.
  Сущности могут существовать без babylon сцены
  В движке создаются свои сцены, все сущности привязываются к одной из них.
  При переключении сцены движка все сущности из прошлой активной сцены деактивируются и активируются новые
  При этом всё, что находится в babylon сцене заранее помещается в AssetContainer и переключается вместе со сценой движка

-- DEPRECATED --
- Refactor entity to use RxJS for setters, onSet and onGet events.
  
- No BABYLON imports. 
(Impossible to not use babylon outside architecture, architecture now just creates basis for game)


-- TODO --
- Engine error handling mechanism.  

- Add accessor to save extender config.  

- Add extender registry.

- Add entity serialization into entity config object.

- Add entity construction by entity config object.

- При загрузке игры создается новая сцена с нуля?
- Ресурсы совместные для всех сцен, но знают какие сцены их используют и очищаются при очистке сцены

- Ленивая загрузка ресурсов vs рання. Как определить какие ресурсы нужно загрузить заранее?

- В какой момент загружать ресурсы сцены?
Хук перед запуском сцены для создания начальных сущностей и определения ресурсов для загрузки

- Dynamic entities

- Абстракция вебсокетов
Init
Create connection  
Receive(Connection, MessageType, Handler)
Send(Connection, Message)
  
- Сделать возможность сохранения и загрузки состояния без необходимости дополнительных действий разработчика внутри экстендера (сохранённое состояние передается в аргумент класса EntityExtenderInstance)
SaveSystem добавляет дополнительный хук в экстендеры который получает доступ к состоянию экстендера. 
updateState() вызывает этот хук и позволяет системе реагировать на изменения состояния
    
- Сохранение должно быть реализовано в виде системы, но при этом расширять поведение движка без прямого использования
(Плагины? Дополнительные хуки в системах (могут вызвать проблемы синхронизации)?)

- Движок должен ждать загрузки всех (только необходимых?) систем перед запуском приложения

- Система синхронизации по сети должна так же работать без дополнительного вмешательства
Система добавляет хук на update и синхронизирует данные по сети между пользователями вызывая 
Update самостоятельно у клиентов

- Адаптеры для разных сетевых протоколов

- Адаптеры для сохранения в разные файловые системы

- Конфиг систем в виде { [SystemName]: SystemConfigType }

- Сделать Entity систему чтобы снизить сложность архитектуры? 
Все системы которым нужны сцены смогут запросить систему сцен напрямую.
Система сущностей будет позволять встроить хуки (для системы сохранений и сети), хранить список всех сущностей сцены и тд
  
- Каждая сущность должна корректно сереализоваться и загружаться отдельно для удобства разработки и тестирования

- Сформировать требования к проекту

- Возможность отключать сущности, отдельные экстендеры в них (например, для переключения сцен)

- Параметры сущности (не все сущности одного типа одинаковые изначально, для некоторых можно кастомизировать параметры)

- Узлы не должны создаваться напрямую пользователем, для этого должна быть специальная система, она и будет прописывать их в сцену движка